# ROCm Stability Configuration
# Fixes HIPBLAS_STATUS_INTERNAL_ERROR crashes during training
# Tested on: AMD Radeon AI PRO R9700 (gfx1201) with ROCm 7.12

# Enable fine-grained memory for PCIe operations
export HSA_FORCE_FINE_GRAIN_PCIE=1

# Limit hardware queue count (prevents queue overflow)
export GPU_MAX_HW_QUEUES=4

# Split large memory allocations (prevents fragmentation)
export PYTORCH_HIP_ALLOC_CONF=max_split_size_mb:512

# Note: PYTORCH_HIP_ALLOC_CONF is deprecated, but still works
# New systems should use: PYTORCH_ALLOC_CONF=max_split_size_mb:512
